(s=>{s(document).ready(function(){var e,o;function n(){var i;e?e.show():(i=(i=(i=(i=(i='<div class="inspiro-deactivation-modal-overlay">')+'<div class="inspiro-deactivation-modal"><div class="inspiro-deactivation-modal-header">')+"<h2>"+inspiroThemeDeactivateData.labels.title+"</h2>")+'<button class="inspiro-deactivation-modal-close">&times;</button></div>')+'<div class="inspiro-deactivation-modal-body"><form id="inspiro-deactivation-form">',inspiroThemeDeactivateData.choices.forEach(function(e){i=(i=(i+='<div class="inspiro-choice-wrapper"><label class="inspiro-choice-label">')+'<input type="checkbox" name="deactivation_reason" value="'+e.slug+'" /> ')+e.label+"</label>",e.text_field&&(i+='<textarea name="'+e.text_field+'" class="inspiro-choice-text" placeholder="Please specify..." rows="2"></textarea>'),i+="</div>"}),i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i+="</form></div>")+'<div class="inspiro-deactivation-modal-footer"><div class="inspiro-consent-section">')+'<label class="inspiro-consent-label"><input type="checkbox" id="inspiro-consent-checkbox" checked /> ')+inspiroThemeDeactivateData.labels.consent_checkbox+"</label>")+'</div><div class="inspiro-privacy-notice">')+inspiroThemeDeactivateData.labels.privacy_disclaimer+"</div>")+'<div class="inspiro-modal-buttons"><button class="inspiro-btn inspiro-btn-secondary" id="inspiro-skip-survey">')+inspiroThemeDeactivateData.labels.skip_deactivate)+'</button><button class="inspiro-btn inspiro-btn-primary" id="inspiro-submit-survey">')+inspiroThemeDeactivateData.labels.submit_deactivate+"</button>")+"</div></div>")+"</div></div>",e=s(i),s("body").append(e),e.find(".inspiro-deactivation-modal-close").on("click",function(){t()}),e.find(".inspiro-deactivation-modal-overlay").on("click",function(e){e.target===this&&t()}),e.find('input[type="checkbox"]').on("change",function(){var e=s(this).val(),i=s(this).is(":checked"),t=s(this).closest(".inspiro-choice-wrapper").find(".inspiro-choice-text");i?(-1===o.choices.indexOf(e)&&o.choices.push(e),t.show()):(-1!==(i=o.choices.indexOf(e))&&o.choices.splice(i,1),t.hide().val(""))}),e.find(".inspiro-choice-text").on("input",function(){var e=s(this).attr("name");o[e]=s(this).val()}),e.find("#inspiro-consent-checkbox").on("change",function(){o.user_consent=s(this).is(":checked")}),e.find("#inspiro-skip-survey").on("click",function(){a()}),e.find("#inspiro-submit-survey").on("click",function(){s("#inspiro-submit-survey").prop("disabled",!0).text("Submitting...");var e={choices:o.choices.join(","),choice_other_text:o.choice_other_text||"",choice_not_enough_features_text:o.choice_not_enough_features_text||"",domain:o.domain,hostname:o.hostname,inspiro_theme_version:o.inspiro_theme_version,wp_version:o.wp_version,language:o.language,php_version:o.php_version,is_multisite:o.is_multisite,active_plugins_count:o.active_plugins_count,timezone_offset:o.timezone_offset,user_agent:o.user_agent,referrer:o.referrer,switching_to_theme:window.inspiroDestinationTheme||"Unknown",user_consent:o.user_consent};o.user_consent&&(e.admin_email=o.admin_email),s.ajax({url:inspiroThemeDeactivateData.ajaxUrl,type:"POST",data:{action:"inspiro_theme_deactivation_survey",nonce:inspiroThemeDeactivateData.nonce,...e}});var i,t=new FormData;for(i in e)e.hasOwnProperty(i)&&(Array.isArray(e[i])?t.append(i,JSON.stringify(e[i])):t.append(i,e[i]));s.ajax({url:inspiroThemeDeactivateData.remoteApiUrl,type:"POST",data:t,processData:!1,contentType:!1,timeout:5e3,success:function(e){console.log("Survey submitted successfully to WPZOOM"),console.log("Server response:",e);try{var i="string"==typeof e?JSON.parse(e):e;console.log("Response data:",i)}catch(e){console.log("Could not parse response:",e)}a()},error:function(e,i,t){console.log("Failed to submit to remote server:",t),console.log("XHR status:",e.status),console.log("Response text:",e.responseText),a()}})}),e.find(".inspiro-choice-text").hide())}function t(){e&&(e.remove(),e=null)}function a(){t(),window.inspiroDeactivationHref&&(window.location.href=window.inspiroDeactivationHref)}console.log("Inspiro deactivation script loaded"),"undefined"==typeof inspiroThemeDeactivateData?console.log("inspiroThemeDeactivateData not found"):(console.log("inspiroThemeDeactivateData:",inspiroThemeDeactivateData),window.testInspiroModal=function(){console.log("Testing Inspiro modal..."),n()},e=null,o={choices:[],domain:inspiroThemeDeactivateData.domain,hostname:inspiroThemeDeactivateData.hostname,inspiro_theme_version:inspiroThemeDeactivateData.inspiroThemeVersion,wp_version:inspiroThemeDeactivateData.wpVersion,language:document.documentElement.getAttribute("lang")||"en-US",php_version:inspiroThemeDeactivateData.phpVersion||"Unknown",is_multisite:inspiroThemeDeactivateData.isMultisite||!1,active_plugins_count:inspiroThemeDeactivateData.activePluginsCount||0,admin_email:inspiroThemeDeactivateData.adminEmail||"",timezone_offset:(new Date).getTimezoneOffset(),user_agent:navigator.userAgent,referrer:document.referrer||"Direct",user_consent:!0},inspiroThemeDeactivateData.choices.forEach(function(e){e.text_field&&(o[e.text_field]="")}),s(document).on("click",'.theme-actions .activate, .theme .theme-actions .button-primary, a[href*="action=activate"]',function(e){var i,t,o;i=s(".current-theme .theme-name").text(),t=s(".theme.active .theme-name").text(),o=s("body").attr("class")||"",(i&&-1!==i.toLowerCase().indexOf("inspiro")||t&&-1!==t.toLowerCase().indexOf("inspiro")||-1!==o.indexOf("inspiro"))&&(i=s(this).attr("href"),(t=s(this).closest(".theme").find(".theme-name").text())&&-1!==t.toLowerCase().indexOf("inspiro")||(window.inspiroDestinationTheme=(t=!(t=s(o=this).closest(".theme").find(".theme-name, .theme-title").text().trim())&&(o=s(o).attr("href"),o=(o=new URLSearchParams(o.split("?")[1])).get("stylesheet")||o.get("template"))?o.replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase()):t)||"Unknown Theme",console.log("Inspiro deactivation intercepted:",i),console.log("Switching to theme:",window.inspiroDestinationTheme),e.preventDefault(),window.inspiroDeactivationHref=i,n()))}),s(document).on("click",'a[href*="action=delete"]',function(e){var i=s(this).attr("href");-1===i.indexOf("stylesheet=inspiro")&&-1===i.indexOf("template=inspiro")||(console.log("Inspiro deletion intercepted:",i),e.preventDefault(),window.inspiroDeactivationHref=i,n())}))})})(jQuery);