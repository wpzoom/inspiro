(r=>{r(document).ready(function(){var o,n;function s(){var t;o?o.show():(t=(t=(t=(t=(t='<div class="inspiro-deactivation-modal-overlay">')+'<div class="inspiro-deactivation-modal"><div class="inspiro-deactivation-modal-header">')+"<h2>"+inspiroThemeDeactivateData.labels.title+"</h2>")+'<button class="inspiro-deactivation-modal-close">&times;</button></div>')+'<div class="inspiro-deactivation-modal-body"><form id="inspiro-deactivation-form">',inspiroThemeDeactivateData.choices.forEach(function(e){if(t=(t=(t=t+'<div class="inspiro-choice-wrapper">'+'<label class="inspiro-choice-label">')+('<input type="checkbox" name="deactivation_reason" value="'+e.slug+'" /> '))+e.label+"</label>",e.features_options){for(var i in t=t+'<div class="inspiro-features-options" style="margin-top: 12px; padding-left: 25px;">'+'<div style="margin-bottom: 8px; font-size: 13px; color: #111;">Which features? (Select all that apply)</div>',e.features_options)t=(t=t+'<label class="inspiro-feature-label" style="display: block; margin-bottom: 6px; font-size: 13px;"><input type="checkbox" name="missing_features" value="'+i+'" style="margin-right: 8px;" /> ')+e.features_options[i]+"</label>","other-feature"===i&&(t+='<textarea name="choice_missing_features_other_text" class="inspiro-feature-other-text" placeholder="Please specify..." rows="2" style="width: 100%; margin-top: 6px; margin-left: 20px; display: none;"></textarea>');t+="</div>"}else e.text_field&&(t+='<textarea name="'+e.text_field+'" class="inspiro-choice-text" placeholder="Please specify..." rows="2"></textarea>');t+="</div>"}),t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t+="</form></div>")+'<div class="inspiro-deactivation-modal-footer"><div class="inspiro-consent-section">')+'<label class="inspiro-consent-label"><input type="checkbox" id="inspiro-consent-checkbox" checked /> ')+inspiroThemeDeactivateData.labels.consent_checkbox+"</label>")+'</div><div class="inspiro-privacy-notice">')+inspiroThemeDeactivateData.labels.privacy_disclaimer+"</div>")+'<div class="inspiro-modal-buttons"><button class="inspiro-btn inspiro-btn-secondary" id="inspiro-skip-survey">')+inspiroThemeDeactivateData.labels.skip_deactivate)+'</button><button class="inspiro-btn inspiro-btn-primary" id="inspiro-submit-survey">')+inspiroThemeDeactivateData.labels.submit_deactivate+"</button>")+"</div></div>")+"</div></div>",o=r(t),r("body").append(o),o.find(".inspiro-deactivation-modal-close").on("click",function(){i()}),o.find(".inspiro-deactivation-modal-overlay").on("click",function(e){e.target===this&&i()}),o.find('input[name="deactivation_reason"]').on("change",function(){var e=r(this).val(),i=r(this).is(":checked"),t=r(this).closest(".inspiro-choice-wrapper"),o=t.find(".inspiro-choice-text"),t=t.find(".inspiro-features-options");i?(-1===n.choices.indexOf(e)&&n.choices.push(e),o.show(),t.show()):(-1!==(i=n.choices.indexOf(e))&&n.choices.splice(i,1),o.hide().val(""),t.hide(),t.find('input[type="checkbox"]').prop("checked",!1),t.find(".inspiro-feature-other-text").hide().val(""),n.choice_missing_features="",n.choice_missing_features_other_text="")}),o.find('input[name="missing_features"]').on("change",function(){var e=[],i=(o.find('input[name="missing_features"]:checked').each(function(){e.push(r(this).val())}),n.choice_missing_features=e.join(","),"other-feature"===r(this).val()&&r(this).is(":checked")),t=r(this).closest(".inspiro-features-options").find(".inspiro-feature-other-text");i?t.show():"other-feature"===r(this).val()&&(t.hide().val(""),n.choice_missing_features_other_text="")}),o.find(".inspiro-choice-text, .inspiro-feature-other-text").on("input",function(){var e=r(this).attr("name");n[e]=r(this).val()}),o.find("#inspiro-consent-checkbox").on("change",function(){n.user_consent=r(this).is(":checked")}),o.find("#inspiro-skip-survey").on("click",function(){a()}),o.find("#inspiro-submit-survey").on("click",function(){r("#inspiro-submit-survey").prop("disabled",!0).text("Submitting...");var e={choices:n.choices.join(","),choice_technical_issues_text:n.choice_technical_issues_text||"",choice_plugin_compatibility_text:n.choice_plugin_compatibility_text||"",choice_missing_features:n.choice_missing_features||"",choice_missing_features_other_text:n.choice_missing_features_other_text||"",choice_lack_of_support_text:n.choice_lack_of_support_text||"",choice_other_text:n.choice_other_text||"",domain:n.domain,hostname:n.hostname,inspiro_theme_version:n.inspiro_theme_version,wp_version:n.wp_version,language:n.language,php_version:n.php_version,is_multisite:n.is_multisite,active_plugins_count:n.active_plugins_count,timezone_offset:n.timezone_offset,user_agent:n.user_agent,referrer:n.referrer,switching_to_theme:window.inspiroDestinationTheme||"Unknown",user_consent:n.user_consent};n.user_consent&&(e.admin_email=n.admin_email),r.ajax({url:inspiroThemeDeactivateData.ajaxUrl,type:"POST",data:{action:"inspiro_theme_deactivation_survey",nonce:inspiroThemeDeactivateData.nonce,...e}});var i,t=new FormData;for(i in e)e.hasOwnProperty(i)&&(Array.isArray(e[i])?t.append(i,JSON.stringify(e[i])):t.append(i,e[i]));r.ajax({url:inspiroThemeDeactivateData.remoteApiUrl,type:"POST",data:t,processData:!1,contentType:!1,timeout:5e3,success:function(e){console.log("Survey submitted successfully to WPZOOM"),console.log("Server response:",e);try{var i="string"==typeof e?JSON.parse(e):e;console.log("Response data:",i)}catch(e){console.log("Could not parse response:",e)}a()},error:function(e,i,t){console.log("Failed to submit to remote server:",t),console.log("XHR status:",e.status),console.log("Response text:",e.responseText),a()}})}),o.find(".inspiro-choice-text, .inspiro-features-options").hide())}function i(){o&&(o.remove(),o=null)}function a(){i(),window.inspiroDeactivationHref&&(window.location.href=window.inspiroDeactivationHref)}console.log("Inspiro deactivation script loaded"),"undefined"==typeof inspiroThemeDeactivateData?console.log("inspiroThemeDeactivateData not found"):(console.log("inspiroThemeDeactivateData:",inspiroThemeDeactivateData),window.testInspiroModal=function(){console.log("Testing Inspiro modal..."),s()},o=null,n={choices:[],domain:inspiroThemeDeactivateData.domain,hostname:inspiroThemeDeactivateData.hostname,inspiro_theme_version:inspiroThemeDeactivateData.inspiroThemeVersion,wp_version:inspiroThemeDeactivateData.wpVersion,language:document.documentElement.getAttribute("lang")||"en-US",php_version:inspiroThemeDeactivateData.phpVersion||"Unknown",is_multisite:inspiroThemeDeactivateData.isMultisite||!1,active_plugins_count:inspiroThemeDeactivateData.activePluginsCount||0,admin_email:inspiroThemeDeactivateData.adminEmail||"",timezone_offset:(new Date).getTimezoneOffset(),user_agent:navigator.userAgent,referrer:document.referrer||"Direct",user_consent:!0},inspiroThemeDeactivateData.choices.forEach(function(e){e.text_field&&(n[e.text_field]=""),e.features_options&&(n.choice_missing_features="",n.choice_missing_features_other_text="")}),r(document).on("click",'.theme-actions .activate, .theme .theme-actions .button-primary, a[href*="action=activate"]',function(e){var i,t,o;i=r(".current-theme .theme-name").text(),t=r(".theme.active .theme-name").text(),o=r("body").attr("class")||"",!(i&&-1!==i.toLowerCase().indexOf("inspiro")||t&&-1!==t.toLowerCase().indexOf("inspiro")||-1!==o.indexOf("inspiro"))||(i=r(this).attr("href"))&&-1!==i.indexOf("action=install")||(t=r(this).closest(".theme").find(".theme-name").text())&&-1!==t.toLowerCase().indexOf("inspiro")||(window.inspiroDestinationTheme=((t=r(o=this).closest(".theme").find(".theme-name, .theme-title").text().trim())||(o=r(o).attr("href"))&&(o=(o=new URLSearchParams(o.split("?")[1])).get("stylesheet")||o.get("template"))&&(t=o.replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())),t||"Unknown Theme"),console.log("Inspiro deactivation intercepted:",i),console.log("Switching to theme:",window.inspiroDestinationTheme),e.preventDefault(),window.inspiroDeactivationHref=i,s())}),r(document).on("click",'a[href*="action=delete"]',function(e){var i=r(this).attr("href");-1===i.indexOf("stylesheet=inspiro")&&-1===i.indexOf("template=inspiro")||(console.log("Inspiro deletion intercepted:",i),e.preventDefault(),window.inspiroDeactivationHref=i,s())}))})})(jQuery);